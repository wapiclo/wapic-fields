(l=>{function r(e,t){t&&(t=(e.find('.wcf-repeater-field[data-subfield-id="'+t+'"]').find("input, select, textarea").first().val()||"").toString().trim(),e.find(".wcf-repeater-row-title").text(""!==t?t:"Item"))}function f(e,t){var a=e.find("> .wcf-repeater-row-header .wcf-repeater-accordion-toggle"),i=e.find("> .wcf-repeater-row-body");t?(a.attr("aria-expanded","true"),i.stop(!0,!0).slideDown(150),a.text("▲"),e.addClass("is-active")):(a.attr("aria-expanded","false"),i.stop(!0,!0).slideUp(150),a.text("▼"),e.removeClass("is-active"))}function c(e,c,t){t&&(c.on("input change",'.wcf-repeater-field[data-subfield-id="'+t+'"] input, .wcf-repeater-field[data-subfield-id="'+t+'"] select, .wcf-repeater-field[data-subfield-id="'+t+'"] textarea',function(){r(c,t)}),r(c,t)),c.on("click",".wcf-repeater-accordion-toggle",function(e){e.preventDefault();e="true"===l(this).attr("aria-expanded");f(c,!e)}),c.on("click",".wcf-repeater-remove",function(e){e.preventDefault(),c.remove()});var a=c;function i(){c.find(".wcf-field.has-field-error, .wcf-field-error:visible").length?c.addClass("has-error"):c.removeClass("has-error")}l.fn.select2&&a.find("select.wcf-field-select2").each(function(){var e=l(this),t=e.data("width")||"100%",a=e.data("placeholder")||"",i="true"===(e.data("allow-clear")||"").toString();e.data("select2")&&e.select2("destroy"),e.select2({width:t,placeholder:a,allowClear:i}),e.trigger("change")}),l.fn.wpColorPicker&&a.find("input.wcf-field-color").each(function(){var e=l(this);if(!e.hasClass("wp-color-picker"))try{e.wpColorPicker()}catch(e){}}),l.fn.datepicker&&a.find("input.wcf-field-date").each(function(){var e=l(this);try{e.datepicker()}catch(e){}}),c.find('.wcf-repeater-field[data-wcf-required="1"]').each(function(){l(this).find("input, select, textarea").each(function(){l(this).attr("data-required","true"),l(this).hasClass("wcf-required")||l(this).addClass("wcf-required")})}),i(),c.on("input change blur","input, select, textarea",function(){setTimeout(i,0)}),c.off("click.wcfMedia").on("click.wcfMedia",".wcf-media-select",function(e){var t,a,i;e.preventDefault(),window.wp&&wp.media&&(t=l(this).data("media-type")||"image",e=l(this).data("target"),(a=c.find(e)).length)&&((i=wp.media({title:"gallery"===t?"Select Images":"Select Image",library:{type:"image"},multiple:"gallery"===t})).on("select",function(){var e;"gallery"===t?(e=i.state().get("selection").map(function(e){return e.id}),a.val(e.join(",")).trigger("change")):(e=i.state().get("selection").first())&&(e=e.toJSON(),a.val(e.url||"").trigger("change"))}),i.open())}).on("click.wcfMedia",".wcf-media-clear",function(e){e.preventDefault();e=l(this).data("target"),e=c.find(e);e.length&&e.val("").trigger("change")}).on("click.wcfMedia",".wcf-field-image-upload",function(e){var a,i,r;e.preventDefault(),window.wp&&wp.media&&(e=l(this).data("target"),a=c.find("#"+e),i=c.find("#"+e+"_preview"),(r=wp.media({title:"Select Image",library:{type:"image"},multiple:!1})).on("select",function(){var e,t=r.state().get("selection").first();t&&(t=t.toJSON(),a.val(t.id||"").trigger("change"),i.length)&&(e="",t.url&&(e=e+'<span class="wcf-field-image-thumb"><img src="'+t.url+'"><a href="#" class="wcf-field-remove-image" title="Remove image">×</a></span>'),i.html(e))}),r.open())}).on("click.wcfMedia",".wcf-field-remove-image",function(e){e.preventDefault();var e=l(this).closest(".wcf-field-image-thumb"),t=e.closest(".wcf-repeater-row-body").find("input.wcf-media-id").first();e.remove(),t.length&&t.val("").trigger("change")}).on("click.wcfMedia",".wcf-field-gallery-upload",function(e){var i,r,n;e.preventDefault(),window.wp&&wp.media&&(e=l(this).data("target"),i=c.find("#"+e+".wcf-gallery-ids"),r=c.find("#"+e+"_preview"),(n=wp.media({title:"Select Images",library:{type:"image"},multiple:!0})).on("select",function(){var a,e=n.state().get("selection"),t=e.map(function(e){return e.id});i.val(t.join(",")).trigger("change"),r.length&&(a="",e.each(function(e){var e=e.toJSON(),t=(e.sizes&&e.sizes.thumbnail&&e.sizes.thumbnail.url?e.sizes.thumbnail:e).url;a=a+'<span class="wcf-field-gallery-thumb" data-id="'+e.id+'"><img src="'+t+'" alt=""><a href="#" class="wcf-field-remove-gallery-thumb" title="Remove image">×</a></span>'}),r.html(a))}),n.open())}).on("click.wcfMedia",".wcf-field-remove-gallery-thumb",function(e){e.preventDefault();var e=l(this).closest(".wcf-field-gallery-thumb"),t=String(e.data("id")),a=e.closest(".wcf-repeater-row-body").find("input.wcf-gallery-ids");e.remove(),a.length&&(e=(a.val()||"").split(",").filter(Boolean).filter(function(e){return String(e)!==t}),a.val(e.join(",")).trigger("change"))})}l(document).ready(function(){l(".wcf-repeater").each(function(){var i=l(this),e=i.closest("form"),r=(e.length&&!e.data("wcfPopupBound")&&(e.on("submit.wcfPopup",function(){if(l(this).find(".has-field-error, .wcf-field-error:visible").length)try{alert("Please fix the highlighted fields.")}catch(e){}var e=l(this);setTimeout(function(){e.find(".wcf-repeater-row").each(function(){var e=l(this);e.find(".wcf-field.has-field-error, .wcf-field-error:visible").length?e.addClass("has-error"):e.removeClass("has-error")})},0)}),e.data("wcfPopupBound",!0)),parseInt(i.data("max"),10)||0),n=(i.data("title-field")||"").toString();l.fn.sortable&&i.sortable({items:"> .wcf-repeater-row:not(.wcf-repeater-template)",handle:".wcf-repeater-drag-handle",axis:"y",placeholder:"wcf-repeater-placeholder",update:function(){i.find("> .wcf-repeater-row:not(.wcf-repeater-template)").each(function(t){var e=l(this);e.attr("data-index",t),e.find("[id]").each(function(){var e=l(this).attr("id");e&&(e=e.replace(/_(?:__INDEX__|\d+)_/,"_"+t+"_"),l(this).attr("id",e))}),e.find("[aria-controls]").each(function(){var e=l(this).attr("aria-controls");e&&l(this).attr("aria-controls",e.replace(/_(?:__INDEX__|\d+)_/,"_"+t+"_"))}),e.find("[for]").each(function(){var e=l(this).attr("for");e&&l(this).attr("for",e.replace(/_(?:__INDEX__|\d+)_/,"_"+t+"_"))}),e.find("[name]").each(function(){var e=l(this).attr("name");e&&(e=e.replace(/\[[0-9]+\]/,"["+t+"]"),l(this).attr("name",e))})})}}),i.find(".wcf-repeater-row:not(.wcf-repeater-template)").each(function(){var e=l(this);c(0,e,n),f(e,!1)}),i.on("click",".wcf-repeater-add",function(e){e.preventDefault();var t,a,e=i.find(".wcf-repeater-row:not(.wcf-repeater-template)").length;0<r&&r<=e||((t=i.find(".wcf-repeater-template").first().clone(!0,!0)).removeClass("wcf-repeater-template").show(),a=e,(e=t).find("[name]").each(function(){var e=l(this).attr("name");e&&l(this).attr("name",e.replace("[__INDEX__]","["+a+"]"))}),e.find("[id]").each(function(){var e=l(this).attr("id");e&&l(this).attr("id",e.replace("__INDEX__",String(a)))}),e.find("[aria-controls]").each(function(){var e=l(this).attr("aria-controls");e&&l(this).attr("aria-controls",e.replace("__INDEX__",String(a)))}),e.find("[for]").each(function(){var e=l(this).attr("for");e&&l(this).attr("for",e.replace("__INDEX__",String(a)))}),t.find('input[type="text"], input[type="email"], input[type="url"], input[type="number"], input[type="hidden"], input[type="date"]').val(""),t.find("textarea").val(""),t.find("select").each(function(){var e=l(this);e.prop("multiple")?e.val([]):e.val(e.find("option").first().val()||"")}),t.find("input, select, textarea").prop("disabled",!1).removeAttr("disabled"),i.find(".wcf-repeater-actions").before(t),c(0,t,n),f(t,!0),window.wp&&wp.editor&&"function"==typeof wp.editor.initialize&&t.find("textarea.wcf-field-editor").each(function(){var e=l(this).attr("id");if(e)try{wp.editor.initialize(e,{tinymce:!0,quicktags:!0})}catch(e){}}))})})})})(jQuery);
//# sourceMappingURL=repeater.min.js.map
