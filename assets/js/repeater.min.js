(c=>{function i(e,t){t&&(t=(e.find('.wcf-repeater-field[data-subfield-id="'+t+'"]').find("input, select, textarea").first().val()||"").toString().trim(),e.find(".wcf-repeater-row-title").text(""!==t?t:"Item"))}function f(e,t){var a=e.find("> .wcf-repeater-row-header .wcf-repeater-accordion-toggle"),i=e.find("> .wcf-repeater-row-body");t?(a.attr("aria-expanded","true"),i.stop(!0,!0).slideDown(150),a.text("▲"),e.addClass("is-active")):(a.attr("aria-expanded","false"),i.stop(!0,!0).slideUp(150),a.text("▼"),e.removeClass("is-active"))}function l(e,l,t){function a(){l.find(".wcf-field.has-field-error, .wcf-field-error:visible").length?l.addClass("has-error"):l.removeClass("has-error")}t&&(l.on("input change",'.wcf-repeater-field[data-subfield-id="'+t+'"] input, .wcf-repeater-field[data-subfield-id="'+t+'"] select, .wcf-repeater-field[data-subfield-id="'+t+'"] textarea',function(){i(l,t)}),i(l,t)),l.on("click",".wcf-repeater-accordion-toggle",function(e){e.preventDefault();e="true"===c(this).attr("aria-expanded");f(l,!e)}),l.on("click",".wcf-repeater-remove",function(e){e.preventDefault(),l.remove()}),d(),l.find('.wcf-repeater-field[data-wcf-required="1"]').each(function(){c(this).find("input, select, textarea").each(function(){c(this).attr("data-required","true"),c(this).hasClass("wcf-required")||c(this).addClass("wcf-required")})}),a(),l.on("input change blur","input, select, textarea",function(){setTimeout(a,0)}),l.off("click.wcfMedia").on("click.wcfMedia",".wcf-media-select",function(e){var t,a,i;e.preventDefault(),window.wp&&wp.media&&(t=c(this).data("media-type")||"image",e=c(this).data("target"),(a=l.find(e)).length)&&((i=wp.media({title:"gallery"===t?"Select Images":"Select Image",library:{type:"image"},multiple:"gallery"===t})).on("select",function(){var e;"gallery"===t?(e=i.state().get("selection").map(function(e){return e.id}),a.val(e.join(",")).trigger("change")):(e=i.state().get("selection").first())&&(e=e.toJSON(),a.val(e.url||"").trigger("change"))}),i.open())}).on("click.wcfMedia",".wcf-media-clear",function(e){e.preventDefault();e=c(this).data("target"),e=l.find(e);e.length&&e.val("").trigger("change")}).on("click.wcfMedia",".wcf-field-image-upload",function(e){var a,i,r;e.preventDefault(),window.wp&&wp.media&&(e=c(this).data("target"),a=l.find("#"+e),i=l.find("#"+e+"_preview"),(r=wp.media({title:"Select Image",library:{type:"image"},multiple:!1})).on("select",function(){var e,t=r.state().get("selection").first();t&&(t=t.toJSON(),a.val(t.id||"").trigger("change"),i.length)&&(e="",t.url&&(e=e+'<span class="wcf-field-image-thumb"><img src="'+t.url+'"><a href="#" class="wcf-field-remove-image" title="Remove image">×</a></span>'),i.html(e))}),r.open())}).on("click.wcfMedia",".wcf-field-remove-image",function(e){e.preventDefault();var e=c(this).closest(".wcf-field-image-thumb"),t=e.closest(".wcf-repeater-row-body").find("input.wcf-media-id").first();e.remove(),t.length&&t.val("").trigger("change")}).on("click.wcfMedia",".wcf-field-gallery-upload",function(e){var i,r,n;e.preventDefault(),window.wp&&wp.media&&(e=c(this).data("target"),i=l.find("#"+e+".wcf-gallery-ids"),r=l.find("#"+e+"_preview"),(n=wp.media({title:"Select Images",library:{type:"image"},multiple:!0})).on("select",function(){var a,e=n.state().get("selection"),t=e.map(function(e){return e.id});i.val(t.join(",")).trigger("change"),r.length&&(a="",e.each(function(e){var e=e.toJSON(),t=(e.sizes&&e.sizes.thumbnail&&e.sizes.thumbnail.url?e.sizes.thumbnail:e).url;a=a+'<span class="wcf-field-gallery-thumb" data-id="'+e.id+'"><img src="'+t+'" alt=""><a href="#" class="wcf-field-remove-gallery-thumb" title="Remove image">×</a></span>'}),r.html(a))}),n.open())}).on("click.wcfMedia",".wcf-field-remove-gallery-thumb",function(e){e.preventDefault();var e=c(this).closest(".wcf-field-gallery-thumb"),t=String(e.data("id")),a=e.closest(".wcf-repeater-row-body").find("input.wcf-gallery-ids");e.remove(),a.length&&(e=(a.val()||"").split(",").filter(Boolean).filter(function(e){return String(e)!==t}),a.val(e.join(",")).trigger("change"))})}function d(){wapiFieldColorPickerInit(),wapicFieldSelect2Init(),wapicFieldDatePickerInit()}c(document).ready(function(){c(".wcf-repeater").each(function(){var i=c(this),e=i.closest("form"),r=(e.length&&!e.data("wcfPopupBound")&&(e.on("submit.wcfPopup",function(){if(c(this).find(".has-field-error, .wcf-field-error:visible").length)try{alert("Please fix the highlighted fields.")}catch(e){}var e=c(this);setTimeout(function(){e.find(".wcf-repeater-row").each(function(){var e=c(this);e.find(".wcf-field.has-field-error, .wcf-field-error:visible").length?e.addClass("has-error"):e.removeClass("has-error")})},0)}),e.data("wcfPopupBound",!0)),parseInt(i.data("max"),10)||0),n=(i.data("title-field")||"").toString();c.fn.sortable&&i.sortable({items:"> .wcf-repeater-row:not(.wcf-repeater-template)",handle:".wcf-repeater-drag-handle",axis:"y",placeholder:"wcf-repeater-placeholder",update:function(){i.find("> .wcf-repeater-row:not(.wcf-repeater-template)").each(function(t){var e=c(this);e.attr("data-index",t),e.find("[id]").each(function(){var e=c(this).attr("id");e&&(e=e.replace(/_(?:__INDEX__|\d+)_/,"_"+t+"_"),c(this).attr("id",e))}),e.find("[aria-controls]").each(function(){var e=c(this).attr("aria-controls");e&&c(this).attr("aria-controls",e.replace(/_(?:__INDEX__|\d+)_/,"_"+t+"_"))}),e.find("[for]").each(function(){var e=c(this).attr("for");e&&c(this).attr("for",e.replace(/_(?:__INDEX__|\d+)_/,"_"+t+"_"))}),e.find("[name]").each(function(){var e=c(this).attr("name");e&&(e=e.replace(/\[[0-9]+\]/,"["+t+"]"),c(this).attr("name",e))})})}}),i.find(".wcf-repeater-row:not(.wcf-repeater-template)").each(function(){var e=c(this);l(0,e,n),f(e,!1)}),i.on("click",".wcf-repeater-add",function(e){e.preventDefault();var t,a,e=i.find(".wcf-repeater-row:not(.wcf-repeater-template)").length;0<r&&r<=e||((t=i.find(".wcf-repeater-template").first().clone(!0,!0)).removeClass("wcf-repeater-template").show(),t.find('[class*="wcf-repeater-field"]').each(function(){var e=c(this),t=e.attr("class").split(" ").filter(e=>!e.includes("wcf-repeater-field"));e.attr("class",t.join(" ").trim()||"")}),a=e,(e=t).find("[name]").each(function(){var e=c(this).attr("name");e&&c(this).attr("name",e.replace("[__INDEX__]","["+a+"]"))}),e.find("[id]").each(function(){var e=c(this).attr("id");e&&c(this).attr("id",e.replace("__INDEX__",String(a)))}),e.find("[aria-controls]").each(function(){var e=c(this).attr("aria-controls");e&&c(this).attr("aria-controls",e.replace("__INDEX__",String(a)))}),e.find("[for]").each(function(){var e=c(this).attr("for");e&&c(this).attr("for",e.replace("__INDEX__",String(a)))}),t.find('input[type="text"], input[type="email"], input[type="url"], input[type="number"], input[type="hidden"], input[type="date"]').val(""),t.find("textarea").val(""),t.find("select").each(function(){var e=c(this);e.prop("multiple")?e.val([]):e.val(e.find("option").first().val()||"")}),t.find("input, select, textarea").prop("disabled",!1).removeAttr("disabled"),i.find(".wcf-repeater-actions").before(t),l(0,t,n),f(t,!0),d())})})})})(jQuery);
//# sourceMappingURL=repeater.min.js.map
