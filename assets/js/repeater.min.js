(c=>{function a(e,t){t&&(t=(e.find('.wcf-repeater-field[data-subfield-id="'+t+'"]').find("input, select, textarea").first().val()||"").toString().trim(),e.find(".wcf-repeater-row-title").text(""!==t?t:"Item"))}function f(e,t){var i=e.find("> .wcf-repeater-row-header .wcf-repeater-accordion-toggle"),a=e.find("> .wcf-repeater-row-body");t?(i.attr("aria-expanded","true"),a.stop(!0,!0).slideDown(150),i.text("▲"),e.addClass("is-active")):(i.attr("aria-expanded","false"),a.stop(!0,!0).slideUp(150),i.text("▼"),e.removeClass("is-active"))}function l(e,l,t){function i(){l.find(".wcf-field.has-field-error, .wcf-field-error:visible").length?l.addClass("has-error"):l.removeClass("has-error")}t&&(l.on("input change",'.wcf-repeater-field[data-subfield-id="'+t+'"] input, .wcf-repeater-field[data-subfield-id="'+t+'"] select, .wcf-repeater-field[data-subfield-id="'+t+'"] textarea',function(){a(l,t)}),a(l,t)),l.on("click",".wcf-repeater-accordion-toggle",function(e){e.preventDefault();e="true"===c(this).attr("aria-expanded");f(l,!e)}),l.on("click",".wcf-repeater-remove",function(e){e.preventDefault(),l.remove()}),d(l),l.find('.wcf-repeater-field[data-wcf-required="1"]').each(function(){c(this).find("input, select, textarea").each(function(){c(this).attr("data-required","true"),c(this).hasClass("wcf-required")||c(this).addClass("wcf-required")})}),i(),l.on("input change blur","input, select, textarea",function(){setTimeout(i,0)}),l.off("click.wcfMedia").on("click.wcfMedia",".wcf-media-select",function(e){var t,i,a;e.preventDefault(),window.wp&&wp.media&&(t=c(this).data("media-type")||"image",e=c(this).data("target"),(i=l.find(e)).length)&&((a=wp.media({title:"gallery"===t?"Select Images":"Select Image",library:{type:"image"},multiple:"gallery"===t})).on("select",function(){var e;"gallery"===t?(e=a.state().get("selection").map(function(e){return e.id}),i.val(e.join(",")).trigger("change")):(e=a.state().get("selection").first())&&(e=e.toJSON(),i.val(e.url||"").trigger("change"))}),a.open())}).on("click.wcfMedia",".wcf-media-clear",function(e){e.preventDefault();e=c(this).data("target"),e=l.find(e);e.length&&e.val("").trigger("change")}).on("click.wcfMedia",".wcf-field-image-upload",function(e){var i,a,r;e.preventDefault(),window.wp&&wp.media&&(e=c(this).data("target"),i=l.find("#"+e),a=l.find("#"+e+"_preview"),(r=wp.media({title:"Select Image",library:{type:"image"},multiple:!1})).on("select",function(){var e,t=r.state().get("selection").first();t&&(t=t.toJSON(),i.val(t.id||"").trigger("change"),a.length)&&(e="",t.url&&(e=e+'<span class="wcf-field-image-thumb"><img src="'+t.url+'"><a href="#" class="wcf-field-remove-image" title="Remove image">×</a></span>'),a.html(e))}),r.open())}).on("click.wcfMedia",".wcf-field-remove-image",function(e){e.preventDefault();var e=c(this).closest(".wcf-field-image-thumb"),t=e.closest(".wcf-repeater-row-body").find("input.wcf-media-id").first();e.remove(),t.length&&t.val("").trigger("change")}).on("click.wcfMedia",".wcf-field-gallery-upload",function(e){var a,r,n;e.preventDefault(),window.wp&&wp.media&&(e=c(this).data("target"),a=l.find("#"+e+".wcf-gallery-ids"),r=l.find("#"+e+"_preview"),(n=wp.media({title:"Select Images",library:{type:"image"},multiple:!0})).on("select",function(){var i,e=n.state().get("selection"),t=e.map(function(e){return e.id});a.val(t.join(",")).trigger("change"),r.length&&(i="",e.each(function(e){var e=e.toJSON(),t=(e.sizes&&e.sizes.thumbnail&&e.sizes.thumbnail.url?e.sizes.thumbnail:e).url;i=i+'<span class="wcf-field-gallery-thumb" data-id="'+e.id+'"><img src="'+t+'" alt=""><a href="#" class="wcf-field-remove-gallery-thumb" title="Remove image">×</a></span>'}),r.html(i))}),n.open())}).on("click.wcfMedia",".wcf-field-remove-gallery-thumb",function(e){e.preventDefault();var e=c(this).closest(".wcf-field-gallery-thumb"),t=String(e.data("id")),i=e.closest(".wcf-repeater-row-body").find("input.wcf-gallery-ids");e.remove(),i.length&&(e=(i.val()||"").split(",").filter(Boolean).filter(function(e){return String(e)!==t}),i.val(e.join(",")).trigger("change"))})}function d(e){"function"==typeof wapicFieldMediaUploader&&new wapicFieldMediaUploader,"function"==typeof wapiFieldColorPickerInit&&wapiFieldColorPickerInit(),"function"==typeof wapicFieldSelect2Init&&wapicFieldSelect2Init(),"function"==typeof wapicFieldDatePickerInit&&wapicFieldDatePickerInit(),"undefined"!=typeof wp&&wp.editor&&e.find(".wcf-field-editor").each(function(){var e=c(this).attr("id");try{wp.editor.remove(e)}catch(e){}wp.editor.initialize(e,{tinymce:{wpautop:!0,toolbar1:"bold italic underline | alignleft aligncenter alignright"},quicktags:!0})})}c(document).ready(function(){c(".wcf-repeater").each(function(){var a=c(this),e=a.closest("form"),r=(e.length&&!e.data("wcfPopupBound")&&(e.on("submit.wcfPopup",function(){if(c(this).find(".has-field-error, .wcf-field-error:visible").length)try{alert("Please fix the highlighted fields.")}catch(e){}var e=c(this);setTimeout(function(){e.find(".wcf-repeater-row").each(function(){var e=c(this);e.find(".wcf-field.has-field-error, .wcf-field-error:visible").length?e.addClass("has-error"):e.removeClass("has-error")})},0)}),e.data("wcfPopupBound",!0)),parseInt(a.data("max"),10)||0),n=(a.data("title-field")||"").toString();c.fn.sortable&&a.sortable({items:"> .wcf-repeater-row:not(.wcf-repeater-template)",handle:".wcf-repeater-drag-handle",axis:"y",placeholder:"wcf-repeater-placeholder",update:function(){a.find("> .wcf-repeater-row:not(.wcf-repeater-template)").each(function(t){var e=c(this);e.attr("data-index",t),e.find("[id]").each(function(){var e=c(this).attr("id");e&&(e=e.replace(/_(?:__INDEX__|\d+)_/,"_"+t+"_"),c(this).attr("id",e))}),e.find("[aria-controls]").each(function(){var e=c(this).attr("aria-controls");e&&c(this).attr("aria-controls",e.replace(/_(?:__INDEX__|\d+)_/,"_"+t+"_"))}),e.find("[for]").each(function(){var e=c(this).attr("for");e&&c(this).attr("for",e.replace(/_(?:__INDEX__|\d+)_/,"_"+t+"_"))}),e.find("[name]").each(function(){var e=c(this).attr("name");e&&(e=e.replace(/\[[0-9]+\]/,"["+t+"]"),c(this).attr("name",e))})})}}),a.find(".wcf-repeater-row:not(.wcf-repeater-template)").each(function(){var e=c(this);l(0,e,n),f(e,!1)}),a.on("click",".wcf-repeater-add",function(e){e.preventDefault();var t,i,e=a.find(".wcf-repeater-row:not(.wcf-repeater-template)").length;0<r&&r<=e||((t=a.find(".wcf-repeater-template").first().clone(!0,!0)).removeClass("wcf-repeater-template").show(),t.find('[class*="wcf-repeater-field"]').each(function(){var e=c(this),t=e.attr("class").split(" ").filter(e=>!e.includes("wcf-repeater-field"));e.attr("class",t.join(" ").trim()||"")}),i=e,(e=t).find("[name]").each(function(){var e=c(this).attr("name");e&&c(this).attr("name",e.replace("[__INDEX__]","["+i+"]"))}),e.find("[id]").each(function(){var e=c(this).attr("id");e&&c(this).attr("id",e.replace("__INDEX__",String(i)))}),e.find("[aria-controls]").each(function(){var e=c(this).attr("aria-controls");e&&c(this).attr("aria-controls",e.replace("__INDEX__",String(i)))}),e.find("[for]").each(function(){var e=c(this).attr("for");e&&c(this).attr("for",e.replace("__INDEX__",String(i)))}),t.find('input[type="text"], input[type="email"], input[type="url"], input[type="number"], input[type="hidden"], input[type="date"]').val(""),t.find("textarea").val(""),t.find("select").each(function(){var e=c(this);e.prop("multiple")?e.val([]):e.val(e.find("option").first().val()||"")}),t.find("input, select, textarea").prop("disabled",!1).removeAttr("disabled"),a.find(".wcf-repeater-actions").before(t),l(0,t,n),f(t,!0),d(t))})})})})(jQuery);
//# sourceMappingURL=repeater.min.js.map
