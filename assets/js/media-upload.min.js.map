{"version":3,"file":"media-upload.min.js","sources":["media-upload.js"],"sourcesContent":["(function(window, document, wp) {\n    'use strict';\n\n    class MediaUploader {\n        constructor() {\n            this.init();\n        }\n\n        /*====================================================*/\n        /* Init All */\n        /*====================================================*/\n        init() {\n            document.addEventListener('DOMContentLoaded', () => {\n                this.initImageUploader();\n                this.initRemoveImage();\n                this.initGalleryUploader();\n                this.initRemoveGalleryThumb();\n                this.initFileUploader();\n            });\n        }\n\n        /*====================================================*/\n        /* Helper */\n        /*====================================================*/\n        getPreviewElement(button, targetId) {\n            let preview = document.getElementById(targetId + '_preview');\n            if (!preview) {\n                let parent = button.parentElement;\n                preview = parent.querySelector('.wcf-field-image-preview, .wcf-field-gallery-preview');\n            }\n            return preview;\n        }\n\n        /*====================================================*/\n        /* Image Uploader */\n        /*====================================================*/\n        initImageUploader() {\n            document.body.addEventListener('click', (e) => {\n                if (!e.target.matches('.wcf-field-image-upload')) return;\n                e.preventDefault();\n\n                let button = e.target;\n                let targetId = button.getAttribute('data-target');\n                let targetInput = document.getElementById(targetId);\n                let preview = this.getPreviewElement(button, targetId);\n                let form = button.closest('form');\n                let isTermForm = form && form.id === 'edittag';\n\n                let frame = wp.media({\n                    title: 'Select Image',\n                    button: { text: 'Use Image' },\n                    multiple: false\n                });\n\n                frame.on('select', () => {\n                    let attachment = frame.state().get('selection').first().toJSON();\n                    let thumb = (attachment.sizes && attachment.sizes.thumbnail) ? attachment.sizes.thumbnail.url :\n                        (attachment.icon ? attachment.icon : (attachment.url ? attachment.url : ''));\n\n                    targetInput.value = attachment.id;\n                    targetInput.dispatchEvent(new Event('change', { bubbles: true }));\n\n                    preview.innerHTML =\n                        `<span class=\"wcf-field-image-thumb\">\n                            <img src=\"${thumb}\">\n                            <a href=\"#\" class=\"wcf-field-remove-image\">×</a>\n                        </span>`;\n\n                    if (isTermForm) {\n                        button.textContent = 'Change Thumbnail';\n                    }\n                });\n\n                frame.open();\n            });\n        }\n\n        /*====================================================*/\n        /* Image Removal */\n        /*====================================================*/\n        initRemoveImage() {\n            document.body.addEventListener('click', (e) => {\n                if (!e.target.matches('.wcf-field-remove-image')) return;\n                e.preventDefault();\n\n                let preview = e.target.closest('.wcf-field-image-preview');\n                if (!preview) return;\n\n                let inputId = preview.id.replace('_preview', '');\n                let input = document.getElementById(inputId);\n                let button = preview.closest('.wcf-field').querySelector('.wcf-field-image-upload');\n\n                if (!input) {\n                    input = preview.parentElement.querySelector('input[type=hidden]');\n                }\n\n                if (input) {\n                    input.value = '';\n                    input.dispatchEvent(new Event('change'));\n                }\n                preview.innerHTML = '';\n\n                if (button) {\n                    button.textContent = 'Add Image';\n                }\n            });\n        }\n\n        /*====================================================*/\n        /* Gallery Uploader */\n        /*====================================================*/\n        initGalleryUploader() {\n            document.body.addEventListener('click', (e) => {\n                if (!e.target.matches('.wcf-field-gallery-upload')) return;\n                e.preventDefault();\n\n                let button = e.target;\n                let targetId = button.getAttribute('data-target');\n                let targetInput = document.getElementById(targetId);\n                let preview = this.getPreviewElement(button, targetId);\n                let container = button.closest('.wcf-gallery-actions');\n                let clearButton = container ? container.querySelector('.wcf-field-gallery-clear') : null;\n\n                let frame = wp.media({\n                    title: 'Select Images',\n                    button: { text: 'Use Images' },\n                    multiple: true\n                });\n\n                frame.on('select', () => {\n                    let selection = frame.state().get('selection');\n                    let existingIds = targetInput.value ? targetInput.value.split(',').filter(Boolean) : [];\n                    let newIds = [];\n\n                    selection.each((attachment) => {\n                        let attachmentId = String(attachment.id);\n                        if (!existingIds.includes(attachmentId)) {\n                            newIds.push(attachmentId);\n                        } else {\n                            wp.data.dispatch('core/notices').createNotice(\n                                'warning',\n                                'Gambar dengan ID ' + attachmentId + ' sudah ada di galeri',\n                                { type: 'snackbar', isDismissible: true }\n                            );\n                        }\n                    });\n\n                    if (newIds.length === 0) return;\n\n                    let allIds = [...existingIds, ...newIds];\n                    let ids = allIds.filter(Boolean).map(Number).filter(id => !isNaN(id));\n\n                    preview.innerHTML = '';\n\n                    if (ids.length > 0) {\n                        if (button) button.textContent = 'Edit Gallery';\n                        if (clearButton) clearButton.style.display = 'inline-block';\n\n                        ids.forEach((id) => {\n                            let attachment = wp.media.attachment(id);\n                            attachment.fetch().then(() => {\n                                let data = attachment.toJSON();\n                                let imgUrl = (data.sizes && data.sizes.thumbnail) ?\n                                    data.sizes.thumbnail.url : (data.icon || data.url || '');\n\n                                if (imgUrl) {\n                                    preview.insertAdjacentHTML('beforeend',\n                                        `<span class=\"wcf-field-gallery-thumb\" data-id=\"${id}\">\n                                            <img src=\"${imgUrl}\" style=\"max-width:80px;height:auto;\" alt=\"\">\n                                            <a href=\"#\" class=\"wcf-field-remove-gallery-thumb\" title=\"Remove image\">×</a>\n                                        </span>`\n                                    );\n                                }\n                            });\n                        });\n                    }\n\n                    targetInput.value = ids.join(',');\n                    targetInput.dispatchEvent(new Event('change', { bubbles: true }));\n                });\n\n                frame.open();\n            });\n        }\n\n        /*====================================================*/\n        /* Gallery Removal */\n        /*====================================================*/\n        initRemoveGalleryThumb() {\n            document.body.addEventListener('click', (e) => {\n                if (e.target.matches('.wcf-field-remove-gallery-thumb')) {\n                    e.preventDefault();\n\n                    let thumb = e.target.closest('.wcf-field-gallery-thumb');\n                    if (!thumb) return;\n\n                    let wrapper = thumb.closest('.wcf-field-gallery-preview');\n                    if (!wrapper) return;\n\n                    let inputId = wrapper.id.replace('_preview', '');\n                    let input = document.getElementById(inputId);\n                    if (!input) {\n                        input = wrapper.parentElement.querySelector('input[type=hidden]');\n                    }\n\n                    thumb.remove();\n\n                    let ids = [];\n                    wrapper.querySelectorAll('.wcf-field-gallery-thumb').forEach((el) => {\n                        let id = el.getAttribute('data-id');\n                        if (id) ids.push(id);\n                    });\n\n                    if (input) {\n                        input.value = ids.join(',');\n\n                        if (ids.length === 0) {\n                            let button = wrapper.parentElement.querySelector('.wcf-field-gallery-upload');\n                            let clearButton = wrapper.parentElement.querySelector('.wcf-field-gallery-clear');\n                            if (button) button.textContent = 'Add Gallery';\n                            if (clearButton) clearButton.style.display = 'none';\n                        }\n\n                        input.dispatchEvent(new Event('change'));\n                    }\n                } else if (e.target.matches('.wcf-field-gallery-clear')) {\n                    e.preventDefault();\n\n                    let button = e.target;\n                    let targetId = button.getAttribute('data-target');\n                    let input = document.getElementById(targetId);\n                    let preview = document.getElementById(targetId + '_preview');\n\n                    if (input && preview) {\n                        preview.innerHTML = '';\n                        input.value = '';\n\n                        let uploadButton = button.closest('.wcf-gallery-actions').querySelector('.wcf-field-gallery-upload');\n                        if (uploadButton) uploadButton.textContent = 'Add Gallery';\n\n                        button.style.display = 'none';\n                        input.dispatchEvent(new Event('change'));\n                    }\n                }\n            });\n        }\n\n        /*====================================================*/\n        /* File Uploader */\n        /*====================================================*/\n        initFileUploader() {\n            document.body.addEventListener('click', (e) => {\n                if (!e.target.closest('.wcf-file-upload-button')) return;\n                e.preventDefault();\n\n                let button = e.target.closest('.wcf-file-upload-button');\n                let targetId = button.getAttribute('data-target');\n                let targetInput = document.getElementById(targetId);\n                if (!targetInput) return;\n\n                let frame = wp.media({\n                    title: 'Select File',\n                    button: { text: 'Use Selected' },\n                    multiple: false,\n                    library: { type: '' }\n                });\n\n                frame.on('select', () => {\n                    let attachment = frame.state().get('selection').first().toJSON();\n                    if (attachment && attachment.url) {\n                        let errorElement = document.getElementById(targetInput.id + '_error');\n                        if (errorElement) {\n                            errorElement.style.display = 'none';\n                            errorElement.textContent = '';\n                        }\n\n                        let field = targetInput.closest('.wcf-field');\n                        if (field) field.classList.remove('has-field-error');\n\n                        targetInput.value = attachment.url;\n                        targetInput.dispatchEvent(new Event('change', { bubbles: true }));\n                    }\n                });\n\n                frame.open();\n            });\n        }\n    }\n\n    // Inisialisasi langsung\n    new MediaUploader();\n\n})(window, document, wp);\n"],"names":["document","wp","constructor","this","init","addEventListener","initImageUploader","initRemoveImage","initGalleryUploader","initRemoveGalleryThumb","initFileUploader","getPreviewElement","button","targetId","let","preview","getElementById","parent","parentElement","querySelector","body","e","target","matches","preventDefault","getAttribute","targetInput","form","closest","isTermForm","id","frame","media","title","text","multiple","on","attachment","state","get","first","toJSON","thumb","sizes","thumbnail","url","icon","value","dispatchEvent","Event","bubbles","innerHTML","textContent","open","inputId","replace","input","container","clearButton","selection","existingIds","split","filter","Boolean","newIds","each","attachmentId","String","includes","data","dispatch","createNotice","type","isDismissible","push","length","ids","map","Number","isNaN","style","display","forEach","fetch","then","imgUrl","insertAdjacentHTML","join","wrapper","remove","querySelectorAll","el","uploadButton","library","field","errorElement","classList","window"],"mappings":"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"}