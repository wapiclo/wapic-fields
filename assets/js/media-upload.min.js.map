{"version":3,"file":"media-upload.min.js","sources":["media-upload.js"],"sourcesContent":["class wapicFieldMediaUploader {\n  constructor() {\n    this.init();\n  }\n\n  // ----------------------------------------------------\n  // Init\n  // ----------------------------------------------------\n  init() {\n    document.addEventListener(\"DOMContentLoaded\", () => {\n      this.initImageUploader();\n      this.initRemoveImage();\n      this.initGalleryUploader();\n      this.initRemoveGalleryThumb();\n      this.initFileUploader();\n    });\n  }\n\n  // ----------------------------------------------------\n  // Helper\n  // ----------------------------------------------------\n  getPreviewElement(button, targetId) {\n    let preview = document.getElementById(targetId + \"_preview\");\n    if (!preview) {\n      let parent = button.parentElement;\n      preview = parent.querySelector(\n        \".wcf-field .wcf-field-image-preview, .wcf-field .wcf-field-gallery-preview\"\n      );\n    }\n    return preview;\n  }\n\n  // ----------------------------------------------------\n  // Image Uploader\n  // ----------------------------------------------------\n  initImageUploader() {\n    document.body.addEventListener(\"click\", (e) => {\n      if (!e.target.matches(\".wcf-field .wcf-field-image-upload\")) return;\n      e.preventDefault();\n\n      let button = e.target;\n      let targetId = button.getAttribute(\"data-target\");\n      let targetInput = document.getElementById(targetId);\n      let preview = this.getPreviewElement(button, targetId);\n      let form = button.closest(\"form\");\n      let isTermForm = form && form.id === \"edittag\";\n\n      let frame = wp.media({\n        title: \"Select Image\",\n        button: { text: \"Use Image\" },\n        multiple: false,\n      });\n\n      frame.on(\"select\", () => {\n        let attachment = frame.state().get(\"selection\").first().toJSON();\n        let thumb =\n          attachment.sizes && attachment.sizes.thumbnail\n            ? attachment.sizes.thumbnail.url\n            : attachment.icon\n            ? attachment.icon\n            : attachment.url\n            ? attachment.url\n            : \"\";\n\n        targetInput.value = attachment.id;\n        targetInput.dispatchEvent(new Event(\"change\", { bubbles: true }));\n\n        preview.innerHTML = `<span class=\"wcf-field-image-thumb\">\n                            <img src=\"${thumb}\">\n                            <a href=\"#\" class=\"wcf-field-remove-image\">×</a>\n                        </span>`;\n\n        if (isTermForm) {\n          button.textContent = \"Change Thumbnail\";\n        }\n      });\n\n      frame.open();\n    });\n  }\n\n  // ----------------------------------------------------\n  // Image Removal\n  // ----------------------------------------------------\n  initRemoveImage() {\n    document.body.addEventListener(\"click\", (e) => {\n      if (!e.target.matches(\".wcf-field .wcf-field-remove-image\")) return;\n      e.preventDefault();\n\n      let preview = e.target.closest(\".wcf-field-image-preview\");\n      if (!preview) return;\n\n      let inputId = preview.id.replace(\"_preview\", \"\");\n      let input = document.getElementById(inputId);\n      let button = preview\n        .closest(\".wcf-field\")\n        .querySelector(\".wcf-field-image-upload\");\n\n      if (!input) {\n        input = preview.parentElement.querySelector(\"input[type=hidden]\");\n      }\n\n      if (input) {\n        input.value = \"\";\n        input.dispatchEvent(new Event(\"change\"));\n      }\n      preview.innerHTML = \"\";\n\n      if (button) {\n        button.textContent = \"Add Image\";\n      }\n    });\n  }\n\n  // ----------------------------------------------------\n  // Gallery Uploader\n  // ----------------------------------------------------\n  initGalleryUploader() {\n    document.body.addEventListener(\"click\", (e) => {\n      if (!e.target.matches(\".wcf-field .wcf-field-gallery-upload\")) return;\n      e.preventDefault();\n\n      let button = e.target;\n      let targetId = button.getAttribute(\"data-target\");\n      let targetInput = document.getElementById(targetId);\n      let preview = this.getPreviewElement(button, targetId);\n      let container = button.closest(\".wcf-gallery-actions\");\n      let clearButton = container\n        ? container.querySelector(\".wcf-field-gallery-clear\")\n        : null;\n\n      let frame = wp.media({\n        title: \"Select Images\",\n        button: { text: \"Use Images\" },\n        multiple: true,\n      });\n\n      frame.on(\"select\", () => {\n        let selection = frame.state().get(\"selection\");\n        let existingIds = targetInput.value\n          ? targetInput.value.split(\",\").filter(Boolean)\n          : [];\n        let newIds = [];\n\n        selection.each((attachment) => {\n          let attachmentId = String(attachment.id);\n          if (!existingIds.includes(attachmentId)) {\n            newIds.push(attachmentId);\n          } else {\n            wp.data\n              .dispatch(\"core/notices\")\n              .createNotice(\n                \"warning\",\n                \"Gambar dengan ID \" + attachmentId + \" sudah ada di galeri\",\n                { type: \"snackbar\", isDismissible: true }\n              );\n          }\n        });\n\n        if (newIds.length === 0) return;\n\n        let allIds = [...existingIds, ...newIds];\n        let ids = allIds\n          .filter(Boolean)\n          .map(Number)\n          .filter((id) => !isNaN(id));\n\n        preview.innerHTML = \"\";\n\n        if (ids.length > 0) {\n          if (button) button.textContent = \"Edit Gallery\";\n          if (clearButton) clearButton.style.display = \"inline-block\";\n\n          ids.forEach((id) => {\n            let attachment = wp.media.attachment(id);\n            attachment.fetch().then(() => {\n              let data = attachment.toJSON();\n              let imgUrl =\n                data.sizes && data.sizes.thumbnail\n                  ? data.sizes.thumbnail.url\n                  : data.icon || data.url || \"\";\n\n              if (imgUrl) {\n                preview.insertAdjacentHTML(\n                  \"beforeend\",\n                  `<span class=\"wcf-field-gallery-thumb\" data-id=\"${id}\">\n                                            <img src=\"${imgUrl}\" style=\"max-width:80px;height:auto;\" alt=\"\">\n                                            <a href=\"#\" class=\"wcf-field-remove-gallery-thumb\" title=\"Remove image\">×</a>\n                                        </span>`\n                );\n              }\n            });\n          });\n        }\n\n        targetInput.value = ids.join(\",\");\n        targetInput.dispatchEvent(new Event(\"change\", { bubbles: true }));\n      });\n\n      frame.open();\n    });\n  }\n\n  // ----------------------------------------------------\n  // Gallery Removal\n  // ----------------------------------------------------\n  initRemoveGalleryThumb() {\n    document.body.addEventListener(\"click\", (e) => {\n      if (e.target.matches(\".wcf-field .wcf-field-remove-gallery-thumb\")) {\n        e.preventDefault();\n\n        let thumb = e.target.closest(\".wcf-field-gallery-thumb\");\n        if (!thumb) return;\n\n        let wrapper = thumb.closest(\".wcf-field-gallery-preview\");\n        if (!wrapper) return;\n\n        let inputId = wrapper.id.replace(\"_preview\", \"\");\n        let input = document.getElementById(inputId);\n        if (!input) {\n          input = wrapper.parentElement.querySelector(\"input[type=hidden]\");\n        }\n\n        thumb.remove();\n\n        let ids = [];\n        wrapper.querySelectorAll(\".wcf-field-gallery-thumb\").forEach((el) => {\n          let id = el.getAttribute(\"data-id\");\n          if (id) ids.push(id);\n        });\n\n        if (input) {\n          input.value = ids.join(\",\");\n\n          if (ids.length === 0) {\n            let button = wrapper.parentElement.querySelector(\n              \".wcf-field-gallery-upload\"\n            );\n            let clearButton = wrapper.parentElement.querySelector(\n              \".wcf-field-gallery-clear\"\n            );\n            if (button) button.textContent = \"Add Gallery\";\n            if (clearButton) clearButton.style.display = \"none\";\n          }\n\n          input.dispatchEvent(new Event(\"change\"));\n        }\n      } else if (e.target.matches(\".wcf-field-gallery-clear\")) {\n        e.preventDefault();\n\n        let button = e.target;\n        let targetId = button.getAttribute(\"data-target\");\n        let input = document.getElementById(targetId);\n        let preview = document.getElementById(targetId + \"_preview\");\n\n        if (input && preview) {\n          preview.innerHTML = \"\";\n          input.value = \"\";\n\n          let uploadButton = button\n            .closest(\".wcf-gallery-actions\")\n            .querySelector(\".wcf-field-gallery-upload\");\n          if (uploadButton) uploadButton.textContent = \"Add Gallery\";\n\n          button.style.display = \"none\";\n          input.dispatchEvent(new Event(\"change\"));\n        }\n      }\n    });\n  }\n\n  // ----------------------------------------------------\n  // File Uploader\n  // ----------------------------------------------------\n  initFileUploader() {\n    document.body.addEventListener(\"click\", (e) => {\n      if (!e.target.closest(\".wcf-field .wcf-file-upload-button\")) return;\n      e.preventDefault();\n\n      let button = e.target.closest(\".wcf-file-upload-button\");\n      let targetId = button.getAttribute(\"data-target\");\n      let targetInput = document.getElementById(targetId);\n      if (!targetInput) return;\n\n      let frame = wp.media({\n        title: \"Select File\",\n        button: { text: \"Use Selected\" },\n        multiple: false,\n        library: { type: \"\" },\n      });\n\n      frame.on(\"select\", () => {\n        let attachment = frame.state().get(\"selection\").first().toJSON();\n        if (attachment && attachment.url) {\n          let errorElement = document.getElementById(targetInput.id + \"_error\");\n          if (errorElement) {\n            errorElement.style.display = \"none\";\n            errorElement.textContent = \"\";\n          }\n\n          let field = targetInput.closest(\".wcf-field\");\n          if (field) field.classList.remove(\"has-field-error\");\n\n          targetInput.value = attachment.url;\n          targetInput.dispatchEvent(new Event(\"change\", { bubbles: true }));\n        }\n      });\n\n      frame.open();\n    });\n  }\n}\n// Inisialisasi langsung\nnew wapicFieldMediaUploader();\n"],"names":["wapicFieldMediaUploader","constructor","this","init","document","addEventListener","initImageUploader","initRemoveImage","initGalleryUploader","initRemoveGalleryThumb","initFileUploader","getPreviewElement","button","targetId","let","preview","getElementById","parent","parentElement","querySelector","body","e","target","matches","preventDefault","getAttribute","targetInput","form","closest","isTermForm","id","frame","wp","media","title","text","multiple","on","attachment","state","get","first","toJSON","thumb","sizes","thumbnail","url","icon","value","dispatchEvent","Event","bubbles","innerHTML","textContent","open","inputId","replace","input","container","clearButton","selection","existingIds","split","filter","Boolean","newIds","each","attachmentId","String","includes","data","dispatch","createNotice","type","isDismissible","push","length","ids","map","Number","isNaN","style","display","forEach","fetch","then","imgUrl","insertAdjacentHTML","join","wrapper","remove","querySelectorAll","el","uploadButton","library","field","errorElement","classList"],"mappings":"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"}