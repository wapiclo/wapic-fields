{"version":3,"file":"media-upload.min.js","sources":["media-upload.js"],"sourcesContent":["class wapicFieldMediaUploader {\n  constructor() {\n    this.init();\n  }\n\n  // ----------------------------------------------------\n  // Init\n  // ----------------------------------------------------\n  init() {\n    document.addEventListener(\"DOMContentLoaded\", () => {\n      this.initImageUploader();\n      this.initRemoveImage();\n      this.initGalleryUploader();\n      this.initRemoveGalleryThumb();\n      this.initFileUploader();\n    });\n  }\n\n  // ----------------------------------------------------\n  // Helper\n  // ----------------------------------------------------\n  getPreviewElement(button, targetId) {\n    let preview = document.getElementById(targetId + \"_preview\");\n    if (!preview) {\n      let parent = button.parentElement;\n      // Jika parent ditemukan .wcf-repeater-field, maka hentikan\n      if (parent && parent.closest(\".wcf-repeater-field\")) return null;\n      preview = parent.querySelector(\n        \".wcf-field .wcf-field-image-preview, .wcf-field .wcf-field-gallery-preview\"\n      );\n    }\n    return preview;\n  }\n\n  // ----------------------------------------------------\n  // Image Uploader\n  // ----------------------------------------------------\n  initImageUploader() {\n    document.body.addEventListener(\"click\", (e) => {\n      const button = e.target.closest(\".wcf-field .wcf-field-image-upload\");\n      if (!button) return;\n      if (button.closest(\".wcf-repeater-field\")) return; // stop jika di repeater\n\n      e.preventDefault();\n\n      const targetId = button.getAttribute(\"data-target\");\n      const targetInput = document.getElementById(targetId);\n      const preview = this.getPreviewElement(button, targetId);\n      const form = button.closest(\"form\");\n      const isTermForm = form && form.id === \"edittag\";\n\n      const frame = wp.media({\n        title: \"Select Image\",\n        button: { text: \"Use Image\" },\n        multiple: false,\n      });\n\n      frame.on(\"select\", () => {\n        const attachment = frame.state().get(\"selection\").first().toJSON();\n        const thumb =\n          (attachment.sizes && attachment.sizes.thumbnail?.url) ||\n          attachment.icon ||\n          attachment.url ||\n          \"\";\n\n        targetInput.value = attachment.id;\n        targetInput.dispatchEvent(new Event(\"change\", { bubbles: true }));\n\n        preview.innerHTML = `\n          <span class=\"wcf-field-image-thumb\">\n            <img src=\"${thumb}\">\n            <a href=\"#\" class=\"wcf-field-remove-image\">×</a>\n          </span>\n        `;\n\n        if (isTermForm) button.textContent = \"Change Thumbnail\";\n      });\n\n      frame.open();\n    });\n  }\n\n  // ----------------------------------------------------\n  // Image Removal\n  // ----------------------------------------------------\n  initRemoveImage() {\n    document.body.addEventListener(\"click\", (e) => {\n      const removeBtn = e.target.closest(\".wcf-field .wcf-field-remove-image\");\n      if (!removeBtn) return;\n      if (removeBtn.closest(\".wcf-repeater-field\")) return; // stop jika di repeater\n\n      e.preventDefault();\n\n      const preview = removeBtn.closest(\".wcf-field-image-preview\");\n      if (!preview) return;\n\n      const inputId = preview.id.replace(\"_preview\", \"\");\n      const input = document.getElementById(inputId);\n      const button = preview\n        .closest(\".wcf-field\")\n        ?.querySelector(\".wcf-field-image-upload\");\n\n      if (input) {\n        input.value = \"\";\n        input.dispatchEvent(new Event(\"change\"));\n      }\n\n      preview.innerHTML = \"\";\n      if (button) button.textContent = \"Add Image\";\n    });\n  }\n\n  // ----------------------------------------------------\n  // Gallery Uploader\n  // ----------------------------------------------------\n  initGalleryUploader() {\n    document.body.addEventListener(\"click\", (e) => {\n      const button = e.target.closest(\".wcf-field .wcf-field-gallery-upload\");\n      if (!button) return;\n      if (button.closest(\".wcf-repeater-field\")) return; // stop jika di repeater\n\n      e.preventDefault();\n\n      const targetId = button.getAttribute(\"data-target\");\n      const targetInput = document.getElementById(targetId);\n      const preview = this.getPreviewElement(button, targetId);\n      const container = button.closest(\".wcf-gallery-actions\");\n      const clearButton = container?.querySelector(\".wcf-field-gallery-clear\");\n\n      const frame = wp.media({\n        title: \"Select Images\",\n        button: { text: \"Use Images\" },\n        multiple: true,\n      });\n\n      frame.on(\"select\", () => {\n        const selection = frame.state().get(\"selection\");\n        const existingIds = targetInput.value\n          ? targetInput.value.split(\",\").filter(Boolean)\n          : [];\n        const newIds = [];\n\n        selection.each((attachment) => {\n          const id = String(attachment.id);\n          if (!existingIds.includes(id)) {\n            newIds.push(id);\n          } else {\n            wp.data\n              .dispatch(\"core/notices\")\n              .createNotice(\"warning\", \"Image ID \" + id + \" already exists\", {\n                type: \"snackbar\",\n                isDismissible: true,\n              });\n          }\n        });\n\n        if (!newIds.length) return;\n\n        const ids = [...existingIds, ...newIds]\n          .filter(Boolean)\n          .map(Number)\n          .filter((id) => !isNaN(id));\n\n        preview.innerHTML = \"\";\n        if (ids.length > 0) {\n          button.textContent = \"Edit Gallery\";\n          if (clearButton) clearButton.style.display = \"inline-block\";\n\n          ids.forEach((id) => {\n            const attachment = wp.media.attachment(id);\n            attachment.fetch().then(() => {\n              const data = attachment.toJSON();\n              const imgUrl =\n                (data.sizes && data.sizes.thumbnail?.url) ||\n                data.icon ||\n                data.url ||\n                \"\";\n\n              if (imgUrl) {\n                preview.insertAdjacentHTML(\n                  \"beforeend\",\n                  `<span class=\"wcf-field-gallery-thumb\" data-id=\"${id}\">\n                    <img src=\"${imgUrl}\" style=\"max-width:80px;height:auto;\" alt=\"\">\n                    <a href=\"#\" class=\"wcf-field-remove-gallery-thumb\" title=\"Remove image\">×</a>\n                  </span>`\n                );\n              }\n            });\n          });\n        }\n\n        targetInput.value = ids.join(\",\");\n        targetInput.dispatchEvent(new Event(\"change\", { bubbles: true }));\n      });\n\n      frame.open();\n    });\n  }\n\n  // ----------------------------------------------------\n  // Gallery Removal & Clear\n  // ----------------------------------------------------\n  initRemoveGalleryThumb() {\n    document.body.addEventListener(\"click\", (e) => {\n      // Hapus satu gambar dari galeri\n      const removeBtn = e.target.closest(\".wcf-field .wcf-field-remove-gallery-thumb\");\n      if (removeBtn) {\n        if (removeBtn.closest(\".wcf-repeater-field\")) return; // stop jika di repeater\n        e.preventDefault();\n\n        const thumb = removeBtn.closest(\".wcf-field-gallery-thumb\");\n        if (!thumb) return;\n\n        const wrapper = thumb.closest(\".wcf-field-gallery-preview\");\n        if (!wrapper) return;\n\n        const inputId = wrapper.id.replace(\"_preview\", \"\");\n        const input = document.getElementById(inputId);\n        thumb.remove();\n\n        const ids = Array.from(wrapper.querySelectorAll(\".wcf-field-gallery-thumb\"))\n          .map((el) => el.getAttribute(\"data-id\"))\n          .filter(Boolean);\n\n        if (input) {\n          input.value = ids.join(\",\");\n          if (!ids.length) {\n            const button = wrapper.parentElement.querySelector(\".wcf-field-gallery-upload\");\n            const clearButton = wrapper.parentElement.querySelector(\".wcf-field-gallery-clear\");\n            if (button) button.textContent = \"Add Gallery\";\n            if (clearButton) clearButton.style.display = \"none\";\n          }\n          input.dispatchEvent(new Event(\"change\"));\n        }\n        return;\n      }\n\n      // Clear seluruh galeri\n      const clearBtn = e.target.closest(\".wcf-field-gallery-clear\");\n      if (clearBtn) {\n        if (clearBtn.closest(\".wcf-repeater-field\")) return; // stop jika di repeater\n        e.preventDefault();\n\n        const targetId = clearBtn.getAttribute(\"data-target\");\n        const input = document.getElementById(targetId);\n        const preview = document.getElementById(targetId + \"_preview\");\n\n        if (input && preview) {\n          preview.innerHTML = \"\";\n          input.value = \"\";\n\n          const uploadBtn = clearBtn\n            .closest(\".wcf-gallery-actions\")\n            ?.querySelector(\".wcf-field-gallery-upload\");\n\n          if (uploadBtn) uploadBtn.textContent = \"Add Gallery\";\n          clearBtn.style.display = \"none\";\n          input.dispatchEvent(new Event(\"change\"));\n        }\n      }\n    });\n  }\n\n  // ----------------------------------------------------\n  // File Uploader\n  // ----------------------------------------------------\n  initFileUploader() {\n    document.body.addEventListener(\"click\", (e) => {\n      const button = e.target.closest(\".wcf-field .wcf-file-upload-button\");\n      if (!button) return;\n      if (button.closest(\".wcf-repeater-field\")) return; // stop jika di repeater\n\n      e.preventDefault();\n\n      const targetId = button.getAttribute(\"data-target\");\n      const targetInput = document.getElementById(targetId);\n      if (!targetInput) return;\n\n      const frame = wp.media({\n        title: \"Select File\",\n        button: { text: \"Use Selected\" },\n        multiple: false,\n      });\n\n      frame.on(\"select\", () => {\n        const attachment = frame.state().get(\"selection\").first().toJSON();\n        if (attachment?.url) {\n          const errorElement = document.getElementById(targetInput.id + \"_error\");\n          if (errorElement) {\n            errorElement.style.display = \"none\";\n            errorElement.textContent = \"\";\n          }\n\n          const field = targetInput.closest(\".wcf-field\");\n          if (field) field.classList.remove(\"has-field-error\");\n\n          targetInput.value = attachment.url;\n          targetInput.dispatchEvent(new Event(\"change\", { bubbles: true }));\n        }\n      });\n\n      frame.open();\n    });\n  }\n}\n\n// Inisialisasi langsung\nnew wapicFieldMediaUploader();\n"],"names":["wapicFieldMediaUploader","constructor","this","init","document","addEventListener","initImageUploader","initRemoveImage","initGalleryUploader","initRemoveGalleryThumb","initFileUploader","getPreviewElement","button","targetId","let","preview","getElementById","parent","parentElement","closest","querySelector","body","e","target","preventDefault","getAttribute","targetInput","form","isTermForm","id","frame","wp","media","title","text","multiple","on","attachment","state","get","first","toJSON","thumb","sizes","thumbnail","url","icon","value","dispatchEvent","Event","bubbles","innerHTML","textContent","open","removeBtn","inputId","replace","input","clearButton","selection","existingIds","split","filter","Boolean","newIds","each","String","includes","data","dispatch","createNotice","type","isDismissible","push","length","ids","map","Number","isNaN","style","display","forEach","fetch","then","imgUrl","insertAdjacentHTML","join","wrapper","remove","Array","from","querySelectorAll","el","uploadBtn","clearBtn","field","errorElement","classList"],"mappings":"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"}