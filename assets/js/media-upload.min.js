((d,c)=>{new class{constructor(){this.init()}init(){d.addEventListener("DOMContentLoaded",()=>{this.initImageUploader(),this.initRemoveImage(),this.initGalleryUploader(),this.initRemoveGalleryThumb(),this.initFileUploader()})}getPreviewElement(e,t){let l=d.getElementById(t+"_preview");return l||(t=e.parentElement,l=t.querySelector(".wcf-field-image-preview, .wcf-field-gallery-preview")),l}initImageUploader(){d.body.addEventListener("click",e=>{if(e.target.matches(".wcf-field-image-upload")){e.preventDefault();let l=e.target;e=l.getAttribute("data-target");let a=d.getElementById(e),i=this.getPreviewElement(l,e);e=l.closest("form");let n=e&&"edittag"===e.id,r=c.media({title:"Select Image",button:{text:"Use Image"},multiple:!1});r.on("select",()=>{var e=r.state().get("selection").first().toJSON(),t=e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail.url:e.icon||e.url||"";a.value=e.id,a.dispatchEvent(new Event("change",{bubbles:!0})),i.innerHTML=`<span class="wcf-field-image-thumb">
                            <img src="${t}">
                            <a href="#" class="wcf-field-remove-image">×</a>
                        </span>`,n&&(l.textContent="Change Thumbnail")}),r.open()}})}initRemoveImage(){d.body.addEventListener("click",t=>{if(t.target.matches(".wcf-field-remove-image")){t.preventDefault();t=t.target.closest(".wcf-field-image-preview");if(t){var l=t.id.replace("_preview","");let e=d.getElementById(l);l=t.closest(".wcf-field").querySelector(".wcf-field-image-upload");(e=e||t.parentElement.querySelector("input[type=hidden]"))&&(e.value="",e.dispatchEvent(new Event("change"))),t.innerHTML="",l&&(l.textContent="Add Image")}}})}initGalleryUploader(){d.body.addEventListener("click",e=>{if(e.target.matches(".wcf-field-gallery-upload")){e.preventDefault();let a=e.target;e=a.getAttribute("data-target");let i=d.getElementById(e),n=this.getPreviewElement(a,e);e=a.closest(".wcf-gallery-actions");let r=e?e.querySelector(".wcf-field-gallery-clear"):null,s=c.media({title:"Select Images",button:{text:"Use Images"},multiple:!0});s.on("select",()=>{var e=s.state().get("selection");let t=i.value?i.value.split(",").filter(Boolean):[],l=[];e.each(e=>{e=String(e.id);t.includes(e)?c.data.dispatch("core/notices").createNotice("warning","Gambar dengan ID "+e+" sudah ada di galeri",{type:"snackbar",isDismissible:!0}):l.push(e)}),0!==l.length&&(e=[...t,...l].filter(Boolean).map(Number).filter(e=>!isNaN(e)),n.innerHTML="",0<e.length&&(a&&(a.textContent="Edit Gallery"),r&&(r.style.display="inline-block"),e.forEach(t=>{let l=c.media.attachment(t);l.fetch().then(()=>{var e=l.toJSON(),e=e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail.url:e.icon||e.url||"";e&&n.insertAdjacentHTML("beforeend",`<span class="wcf-field-gallery-thumb" data-id="${t}">
                                            <img src="${e}" style="max-width:80px;height:auto;" alt="">
                                            <a href="#" class="wcf-field-remove-gallery-thumb" title="Remove image">×</a>
                                        </span>`)})})),i.value=e.join(","),i.dispatchEvent(new Event("change",{bubbles:!0})))}),s.open()}})}initRemoveGalleryThumb(){d.body.addEventListener("click",e=>{if(e.target.matches(".wcf-field-remove-gallery-thumb")){e.preventDefault();var l=e.target.closest(".wcf-field-gallery-thumb");if(l){var a=l.closest(".wcf-field-gallery-preview");if(a){var i=a.id.replace("_preview","");let e=d.getElementById(i),t=(e=e||a.parentElement.querySelector("input[type=hidden]"),l.remove(),[]);a.querySelectorAll(".wcf-field-gallery-thumb").forEach(e=>{e=e.getAttribute("data-id");e&&t.push(e)}),e&&(e.value=t.join(","),0===t.length&&(i=a.parentElement.querySelector(".wcf-field-gallery-upload"),l=a.parentElement.querySelector(".wcf-field-gallery-clear"),i&&(i.textContent="Add Gallery"),l)&&(l.style.display="none"),e.dispatchEvent(new Event("change")))}}}else e.target.matches(".wcf-field-gallery-clear")&&(e.preventDefault(),i=(a=e.target).getAttribute("data-target"),l=d.getElementById(i),e=d.getElementById(i+"_preview"),l)&&e&&(e.innerHTML="",l.value="",(i=a.closest(".wcf-gallery-actions").querySelector(".wcf-field-gallery-upload"))&&(i.textContent="Add Gallery"),a.style.display="none",l.dispatchEvent(new Event("change")))})}initFileUploader(){d.body.addEventListener("click",e=>{if(e.target.closest(".wcf-file-upload-button")){e.preventDefault();e=e.target.closest(".wcf-file-upload-button").getAttribute("data-target");let a=d.getElementById(e);if(a){let l=c.media({title:"Select File",button:{text:"Use Selected"},multiple:!1,library:{type:""}});l.on("select",()=>{var e,t=l.state().get("selection").first().toJSON();t&&t.url&&((e=d.getElementById(a.id+"_error"))&&(e.style.display="none",e.textContent=""),(e=a.closest(".wcf-field"))&&e.classList.remove("has-field-error"),a.value=t.url,a.dispatchEvent(new Event("change",{bubbles:!0})))}),l.open()}}})}}})((window,document),wp);
//# sourceMappingURL=media-upload.min.js.map
