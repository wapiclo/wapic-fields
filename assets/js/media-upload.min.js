class WapicFieldMediaUploader{constructor(){this.init()}init(){document.addEventListener("DOMContentLoaded",()=>{this.initImageUploader(),this.initRemoveImage(),this.initGalleryUploader(),this.initRemoveGalleryThumb(),this.initFileUploader()})}getPreviewElement(e,t){let l=document.getElementById(t+"_preview");if(!l){t=e.parentElement;if(t&&t.closest(".wcf-repeater-template"))return null;l=t.querySelector(".wcf-field .wcf-field-image-preview, .wcf-field .wcf-field-gallery-preview")}return l}initImageUploader(){document.body.addEventListener("click",e=>{let r=e.target.closest(".wcf-field .wcf-field-image-upload");if(r&&!r.closest(".wcf-repeater-template")){e.preventDefault();e=r.getAttribute("data-target");let l=document.getElementById(e),a=this.getPreviewElement(r,e);e=r.closest("form");let i=e&&"edittag"===e.id,n=wp.media({title:"Select Image",button:{text:"Use Image"},multiple:!1});n.on("select",()=>{var e=n.state().get("selection").first().toJSON(),t=e.sizes&&e.sizes.thumbnail?.url||e.icon||e.url||"";l.value=e.id,l.dispatchEvent(new Event("change",{bubbles:!0})),a.innerHTML=`
          <span class="wcf-field-image-thumb">
            <img src="${t}">
            <a href="#" class="wcf-field-remove-image">×</a>
          </span>
        `,console.log(a),i&&(r.textContent="Change Thumbnail")}),n.open()}})}initRemoveImage(){document.body.addEventListener("click",e=>{var t,l=e.target.closest(".wcf-field .wcf-field-remove-image");l&&!l.closest(".wcf-repeater-template")&&(e.preventDefault(),(e=l.closest(".wcf-field-image-preview"))&&(l=e.id.replace("_preview",""),l=document.getElementById(l),t=e.closest(".wcf-field")?.querySelector(".wcf-field-image-upload"),l&&(l.value="",l.dispatchEvent(new Event("change"))),e.innerHTML="",t))&&(t.textContent="Add Image")})}initGalleryUploader(){document.body.addEventListener("click",e=>{let c=e.target.closest(".wcf-field .wcf-field-gallery-upload");if(c&&!c.closest(".wcf-repeater-template")){e.preventDefault();e=c.getAttribute("data-target");let a=document.getElementById(e),i=this.getPreviewElement(c,e),n=c.closest(".wcf-gallery-actions")?.querySelector(".wcf-field-gallery-clear"),r=wp.media({title:"Select Images",button:{text:"Use Images"},multiple:!0});r.on("select",()=>{var e=r.state().get("selection");let t=a.value?a.value.split(",").filter(Boolean):[],l=[];e.each(e=>{e=String(e.id);t.includes(e)?wp.data.dispatch("core/notices").createNotice("warning","Image ID "+e+" already exists",{type:"snackbar",isDismissible:!0}):l.push(e)}),l.length&&(e=[...t,...l].filter(Boolean).map(Number).filter(e=>!isNaN(e)),i.innerHTML="",0<e.length&&(c.textContent="Edit Gallery",n&&(n.style.display="inline-block"),e.forEach(t=>{let l=wp.media.attachment(t);l.fetch().then(()=>{var e=l.toJSON(),e=e.sizes&&e.sizes.thumbnail?.url||e.icon||e.url||"";e&&i.insertAdjacentHTML("beforeend",`<span class="wcf-field-gallery-thumb" data-id="${t}">
                    <img src="${e}" style="max-width:80px;height:auto;" alt="">
                    <a href="#" class="wcf-field-remove-gallery-thumb" title="Remove image">×</a>
                  </span>`)})})),a.value=e.join(","),a.dispatchEvent(new Event("change",{bubbles:!0})))}),r.open()}})}initRemoveGalleryThumb(){document.body.addEventListener("click",e=>{var t=e.target.closest(".wcf-field .wcf-field-remove-gallery-thumb");if(t){if(t.closest(".wcf-repeater-template"))return;e.preventDefault();var t=t.closest(".wcf-field-gallery-thumb");return t?(a=t.closest(".wcf-field-gallery-preview"))?(l=a.id.replace("_preview",""),l=document.getElementById(l),t.remove(),t=Array.from(a.querySelectorAll(".wcf-field-gallery-thumb")).map(e=>e.getAttribute("data-id")).filter(Boolean),void(l&&(l.value=t.join(","),t.length||(t=a.parentElement.querySelector(".wcf-field-gallery-upload"),a=a.parentElement.querySelector(".wcf-field-gallery-clear"),t&&(t.textContent="Add Gallery"),a&&(a.style.display="none")),l.dispatchEvent(new Event("change"))))):void 0:void 0}var l,a,t=e.target.closest(".wcf-field-gallery-clear");t&&!t.closest(".wcf-repeater-template")&&(e.preventDefault(),a=t.getAttribute("data-target"),l=document.getElementById(a),e=document.getElementById(a+"_preview"),l)&&e&&(e.innerHTML="",l.value="",(a=t.closest(".wcf-gallery-actions")?.querySelector(".wcf-field-gallery-upload"))&&(a.textContent="Add Gallery"),t.style.display="none",l.dispatchEvent(new Event("change")))})}initFileUploader(){document.body.addEventListener("click",e=>{var t=e.target.closest(".wcf-field .wcf-file-upload-button");if(t&&!t.closest(".wcf-repeater-template")){e.preventDefault();e=t.getAttribute("data-target");let a=document.getElementById(e);if(a){let l=wp.media({title:"Select File",button:{text:"Use Selected"},multiple:!1});l.on("select",()=>{var e,t=l.state().get("selection").first().toJSON();t?.url&&((e=document.getElementById(a.id+"_error"))&&(e.style.display="none",e.textContent=""),(e=a.closest(".wcf-field"))&&e.classList.remove("has-field-error"),a.value=t.url,a.dispatchEvent(new Event("change",{bubbles:!0})))}),l.open()}}})}}new WapicFieldMediaUploader;
//# sourceMappingURL=media-upload.min.js.map
