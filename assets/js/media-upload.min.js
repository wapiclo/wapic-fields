new class{constructor(){this.init()}init(){document.addEventListener("DOMContentLoaded",()=>{this.initImageUploader(),this.initRemoveImage(),this.initGalleryUploader(),this.initRemoveGalleryThumb(),this.initFileUploader()})}getPreviewElement(e,t){let l=document.getElementById(t+"_preview");if(!l){t=e.parentElement;if(t&&t.closest(".wcf-repeater-template"))return null;l=t.querySelector(".wcf-field .wcf-field-image-preview, .wcf-field .wcf-field-gallery-preview")}return l}initImageUploader(){document.body.addEventListener("click",e=>{let r=e.target.closest(".wcf-field .wcf-field-image-upload");if(r){e.preventDefault();e=r.getAttribute("data-target");let l=document.getElementById(e),i=this.getPreviewElement(r,e);e=r.closest("form");let a=e&&"edittag"===e.id,n=wp.media({title:"Select Image",button:{text:"Use Image"},multiple:!1});n.on("select",()=>{var e=n.state().get("selection").first().toJSON(),t=e.sizes&&e.sizes.thumbnail?.url||e.icon||e.url||"";l.value=e.id,l.dispatchEvent(new Event("change",{bubbles:!0})),i.innerHTML=`
          <span class="wcf-field-image-thumb">
            <img src="${t}">
            <a href="#" class="wcf-field-remove-image">×</a>
          </span>
        `,console.log(i),a&&(r.textContent="Change Thumbnail")}),n.open()}})}initRemoveImage(){document.body.addEventListener("click",e=>{var t,l=e.target.closest(".wcf-field .wcf-field-remove-image");l&&(e.preventDefault(),e=l.closest(".wcf-field-image-preview"))&&(l=e.id.replace("_preview",""),l=document.getElementById(l),t=e.closest(".wcf-field")?.querySelector(".wcf-field-image-upload"),l&&(l.value="",l.dispatchEvent(new Event("change"))),e.innerHTML="",t)&&(t.textContent="Add Image")})}initGalleryUploader(){document.body.addEventListener("click",e=>{let c=e.target.closest(".wcf-field .wcf-field-gallery-upload");if(c){e.preventDefault();e=c.getAttribute("data-target");let i=document.getElementById(e),a=this.getPreviewElement(c,e),n=c.closest(".wcf-gallery-actions")?.querySelector(".wcf-field-gallery-clear"),r=wp.media({title:"Select Images",button:{text:"Use Images"},multiple:!0});r.on("select",()=>{var e=r.state().get("selection");let t=i.value?i.value.split(",").filter(Boolean):[],l=[];e.each(e=>{e=String(e.id);t.includes(e)?wp.data.dispatch("core/notices").createNotice("warning","Image ID "+e+" already exists",{type:"snackbar",isDismissible:!0}):l.push(e)}),l.length&&(e=[...t,...l].filter(Boolean).map(Number).filter(e=>!isNaN(e)),a.innerHTML="",0<e.length&&(c.textContent="Edit Gallery",n&&(n.style.display="inline-block"),e.forEach(t=>{let l=wp.media.attachment(t);l.fetch().then(()=>{var e=l.toJSON(),e=e.sizes&&e.sizes.thumbnail?.url||e.icon||e.url||"";e&&a.insertAdjacentHTML("beforeend",`<span class="wcf-field-gallery-thumb" data-id="${t}">
                    <img src="${e}" style="max-width:80px;height:auto;" alt="">
                    <a href="#" class="wcf-field-remove-gallery-thumb" title="Remove image">×</a>
                  </span>`)})})),i.value=e.join(","),i.dispatchEvent(new Event("change",{bubbles:!0})))}),r.open()}})}initRemoveGalleryThumb(){document.body.addEventListener("click",e=>{var t=e.target.closest(".wcf-field .wcf-field-remove-gallery-thumb");if(t)return e.preventDefault(),(t=t.closest(".wcf-field-gallery-thumb"))&&(i=t.closest(".wcf-field-gallery-preview"))?(l=i.id.replace("_preview",""),l=document.getElementById(l),t.remove(),t=Array.from(i.querySelectorAll(".wcf-field-gallery-thumb")).map(e=>e.getAttribute("data-id")).filter(Boolean),void(l&&(l.value=t.join(","),t.length||(t=i.parentElement.querySelector(".wcf-field-gallery-upload"),i=i.parentElement.querySelector(".wcf-field-gallery-clear"),t&&(t.textContent="Add Gallery"),i&&(i.style.display="none")),l.dispatchEvent(new Event("change"))))):void 0;var l,i,t=e.target.closest(".wcf-field-gallery-clear");t&&(e.preventDefault(),i=t.getAttribute("data-target"),l=document.getElementById(i),e=document.getElementById(i+"_preview"),l)&&e&&(e.innerHTML="",l.value="",(i=t.closest(".wcf-gallery-actions")?.querySelector(".wcf-field-gallery-upload"))&&(i.textContent="Add Gallery"),t.style.display="none",l.dispatchEvent(new Event("change")))})}initFileUploader(){document.body.addEventListener("click",e=>{var t=e.target.closest(".wcf-field .wcf-file-upload-button");if(t){e.preventDefault();e=t.getAttribute("data-target");let i=document.getElementById(e);if(i){let l=wp.media({title:"Select File",button:{text:"Use Selected"},multiple:!1});l.on("select",()=>{var e,t=l.state().get("selection").first().toJSON();t?.url&&((e=document.getElementById(i.id+"_error"))&&(e.style.display="none",e.textContent=""),(e=i.closest(".wcf-field"))&&e.classList.remove("has-field-error"),i.value=t.url,i.dispatchEvent(new Event("change",{bubbles:!0})))}),l.open()}}})}};
//# sourceMappingURL=media-upload.min.js.map
